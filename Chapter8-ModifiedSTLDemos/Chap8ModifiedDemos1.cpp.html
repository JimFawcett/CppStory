<pre>// Chap8ModifiedDemos.cpp
// https://www.fluentcpp.com/2018/03/30/is-stdfor_each-obsolete/

#include &lt;string&gt;
#include &lt;vector&gt;
#include &lt;list&gt;
#include &lt;set&gt;
#include &lt;unordered_map&gt;
#include &lt;iostream&gt;
#include &lt;functional&gt;
#include &lt;algorithm&gt;
#include &lt;type_traits&gt;
#include "../Chapter7-Display/Chap7Display.h"

template&lt;typename V&gt;
class ShowOp {
public:
  ShowOp(const std::string&amp; prefix = ", ") : prefix_(prefix) {}
  void operator()(V v) {
    if (first) {
      std::cout &lt;&lt; "\n  " &lt;&lt; v;
      first = false;
    }
    else {
      std::cout &lt;&lt; prefix_ &lt;&lt; v;
    }
  }
private:
  bool first = true;
  std::string prefix_ = ", ";
};

template&lt;typename V&gt;
class SumOp {
public:
  void operator()(V v) {
    sum_ += v;
  }
  V sum() { return sum_; }
private:
  V sum_;
};

template&lt;typename C&gt;
bool contains(C c, typename C::value_type v) {
  typename C::iterator iter = std::find(c.begin(), c.end(), v);
  return iter != c.end();
}

template&lt;typename C&gt;
void show(C&amp; c) {
  std::cout &lt;&lt; "  ";
  for_each(c.begin(), c.end(), ShowOp&lt;typename C::value_type&gt;());
}

template&lt;typename T&gt;
using Vec = std::vector&lt;T&gt;;

template&lt;typename T&gt;
using Lst = std::list&lt;T&gt;;

template&lt;typename T&gt;
using vecIterator = typename std::vector&lt;T&gt;::iterator;

template&lt;typename O&gt;
struct Null {};

template&lt;typename C, template&lt;typename&gt; class Op = Null&gt;
struct Collection {
  Collection(C&amp; c, Op&lt;typename C::value_type&gt; op_ = Null&lt;typename C::value_type&gt;()) : op(op_) {
    first = c.begin();
    last = c.end();
  }
  typename C::iterator first;
  typename C::iterator last;
  Op&lt;typename C::value_type&gt; op;
};

template&lt;typename C, template&lt;typename&gt; class Op&gt;
typename Op&lt;typename C::value_type&gt; foreach(Collection&lt;C, Op&gt; rng, Op&lt;typename C::value_type&gt; op) {
  return std::for_each(rng.first, rng.last, op);
}

template&lt;typename C, template&lt;typename&gt; class Op&gt;
typename Op&lt;typename C::value_type&gt; foreach(Collection&lt;C&gt; rng, Op&lt;typename C::value_type&gt; op) {
  return std::for_each(rng.first, rng.last, op);
}

template&lt;typename C, template&lt;typename&gt; class Op&gt;
typename Op&lt;typename C::value_type&gt; foreach(Collection&lt;C, Op&gt; rng) {
  return std::for_each(rng.first, rng.last, rng.op);
}

int main() {

  displayDemo("-- traditional algo use --");
  Vec&lt;int&gt; vecInt{ 1, 2, 3, 4, 5 };
  std::for_each(vecInt.begin(), vecInt.end(), ShowOp&lt;int&gt;());

  displayDemo("\n  -- using generic synonyms --");
  Vec&lt;std::string&gt; vecStr{ "Joe", "Sally", "Ashok", "Ming", "Hasim" };
  Collection&lt;Vec&lt;std::string&gt;, ShowOp&gt; rFriends(vecStr, ShowOp&lt;std::string&gt;());

  /*-- std algorithm with synonym arguments*/

  std::for_each(rFriends.first, rFriends.last, rFriends.op);

  /*-- prettified using Collection with embedded operation --*/

  foreach(rFriends);
  
  /*-- prettified using Collection and separate operation --*/

  ShowOp&lt;std::string&gt; showCout;
  foreach(rFriends, showCout);
  putline();

  Collection&lt;Vec&lt;int&gt;, SumOp&gt; vecIntColl(vecInt, SumOp&lt;int&gt;());
  SumOp&lt;int&gt; ret = foreach(vecIntColl, SumOp&lt;int&gt;());
  show(vecInt);
  std::cout &lt;&lt; "\n  sum = " &lt;&lt; ret.sum();

  displayDemo("\n  -- using synonyms --");
  auto first1 = vecInt.begin();
  auto last1 = vecInt.end();
  auto rng1 = std::pair{ first1, last1 };
  auto shop1 = ShowOp&lt;int&gt;();
  auto forEachOne1 = [](decltype(first1) f, decltype(last1) l, decltype(shop1) s) {
    for_each(f, l, s);
  };
  forEachOne1(first1, last1, shop1);

  Lst&lt;double&gt; lstDbl{ 1.0, -0.5, 0.0, 0.5 };
  auto first2 = lstDbl.begin();
  auto last2 = lstDbl.end();
  auto rng2 = std::pair{ first2, last2 };
  auto shop2 = ShowOp&lt;double&gt;();
  auto forEachOne2 = [](decltype(first2) f, decltype(last2) l, decltype(shop2) s) {
    for_each(f, l, s);
  };
  forEachOne2(rng2.first, rng2.second, shop2);

  displayDemo("\n  -- all the rest --");
  putline();
  Vec&lt;double&gt; vecDbl{ 1.0, -1.0, 0.5 };
  Collection&lt;Vec&lt;double&gt;, SumOp&gt; vecDblColl(vecDbl, SumOp&lt;double&gt;());
  
  Collection&lt;Vec&lt;double&gt;&gt; vecDblColl2(vecDbl);

  SumOp&lt;double&gt; retd = foreach(vecDblColl2, SumOp&lt;double&gt;());
  double sumd = foreach(vecDblColl2, SumOp&lt;double&gt;()).sum();
  show(vecDbl);
  std::cout &lt;&lt; "\n  sumd = " &lt;&lt; retd.sum();

  std::list&lt;int&gt; listInt{ 1, 2, 3, 2, 1 };
  Collection&lt;Lst&lt;int&gt;&gt; listIntColl(listInt);
  foreach(listIntColl, ShowOp&lt;int&gt;());
  int sumi = foreach(listIntColl, SumOp&lt;int&gt;()).sum();
  std::cout &lt;&lt; "\n  sum of list = " &lt;&lt; sumi;

  putline(2);
}
</pre>